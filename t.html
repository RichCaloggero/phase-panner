<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta charset="utf-8">
<title>Audio</title>
<style>
label {display: block;}
</style>
</head>

<body>
<h1>Test</h1>

<div id="controls">
<div id="audio">
<h2>Audio</h2>
<label>audio: <input type="text" id="audioFile" accesskey="f"></label>
<button id="load" accesskey="l">Load</button>
<audio tabindex="0"  accesskey="a" controls></audio>
</div>

<div id="parameters">
<label>Parameter: <select id="parameterList"></select></label>
<label>value: <span class="value"></span>
<label>automation frequency: <input id="automationFrequency" type="range" value="1" min="0" max="100" step="0.1"></label>
<label>automation shape: <select id="automationShape"></select></label>
</div><!-- #parameters -->
</div><!-- #controls -->

<div id="message" aria-live="polite"></div>

<script src="ui.js"></script>
<script src="parameters.js"></script>
<script>
const parameters = createParameterMap(parameterData);
console.log(`created ${parameters.size} parameters`);
ui("parameters").addEventListener("change", e => update(e.target.value, e.target, e));
populateSelector (ui("parameterList"), Array.from(parameters.keys()));

function update (value, element, e) {
if (element === ui("parameterList")) display(parameters.get(value));
else updateValue (value);

function display (parameter) {
console.log(`displaying ${parameter.name}...`);
const element = createUiControl(parameter);
const container = document.querySelector("#parameters .value");
container.innerHTML = "";
container.appendChild(element);
} // display

function updateValue (value) {
const parameter = parameters.get(getParameterName());
parameter.value = value;
_update(parameter.updater, value);

function _update (updater, value) {
if (updater instanceof Function) {
updater (value);
} else if (typeof(updater) === "object" && !(updater instanceof Array)) {
if ("value" in updater) updater.value = value;
else if (element.id in updater) updater[element.id] = value;
else throw new Error(`cannot update: ${parameter.name} to ${value} with ${updater}`);

} else if (updater instanceof Array) {
updater.forEach(_updater => _update(_updater, value));
} // if
} // _update
} // updateValue
} // update

function getParameterName () {
return ui("parameterList").value;
} // getParameterName
</script>

</body>
</html>
